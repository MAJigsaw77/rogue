# Project Settings

--resource assets/gl300es/default.frag
--resource assets/gl300es/default.vert

--class-path source

--define android
--define ANDROID_SDK=C:\Users\MAJigsaw77\AppData\Local\Android\Sdk
--define ANDROID_NDK_ROOT=C:\Users\MAJigsaw77\AppData\Local\Android\Sdk\ndk\29.0.13846066

--define analyzer-optimize

--define HXCPP_ANDROID_PLATFORM=24

--library rogue

--main Main

--cpp bin/android

# Compile each Android architecture

--each

# Compile ARM64
--define HXCPP_ARM64

# Create the architecture's directory
--cmd if not exist android-project\app\src\main\jniLibs\arm64-v8a mkdir android-project\app\src\main\jniLibs\arm64-v8a >nul 2>&1

# Copy the libs
--cmd copy bin\android\libMain-64.so android-project\app\src\main\jniLibs\arm64-v8a\libMain.so >nul 2>&1

--next

# Compile ARMV7
--define HXCPP_ARMV7

# Create the architecture's directory
--cmd if not exist android-project\app\src\main\jniLibs\armeabi-v7a mkdir android-project\app\src\main\jniLibs\armeabi-v7a >nul 2>&1

# Copy the libs
--cmd copy bin\android\libMain-v7.so android-project\app\src\main\jniLibs\armeabi-v7a\libMain.so >nul 2>&1

# Copy the Java Files from SDL.
--cmd rmdir /s /q android-project\app\src\main\java\org\libsdl\app
--cmd xcopy ..\thirdparty\submodules\sdl\android-project\app\src\main\java\org\libsdl\app android-project\app\src\main\java\org\libsdl\app /E /I /Y >nul 2>&1

# Enter the android-project.
--cmd cd android-project

# Run gradle
--cmd .\gradlew.bat assembleDebug --console=rich --configuration-cache

# Install the app

--cmd adb install -r app\build\outputs\apk\debug\app-debug.apk

# Start the app

--cmd adb shell am start -n org.haxe.rogue/.GameActivity

# Start scrcpy

# --cmd scrcpy

# Use logcat for debugging

# --cmd adb logcat -c
# --cmd for /f %i in ('adb shell pidof -s org.haxe.rogue') do adb logcat --pid=%i
# --cmd for /f %i in ('adb shell pidof -s org.haxe.rogue') do adb logcat --pid=%i -v brief *:S hidapi:V SDL:V trace:V
# --cmd for /f %i in ('adb shell pidof -s org.haxe.rogue') do adb logcat --pid=%i -v brief *:S SDL:V trace:V
# --cmd for /f %i in ('adb shell pidof -s org.haxe.rogue') do adb logcat --pid=%i -v brief *:S trace:V
