<?xml version="1.0" encoding="UTF-8"?>
<xml>
	<!-- 
		Static linking policy for Rogue:
		- WebAssembly (Emscripten) targets: MUST use static_link
		- All other targets: MUST NOT use static_link
	-->

	<error value="Static linking should only be used for WebAssembly targets" if="static_link" unless="emscripten" />

	<error value="WebAssembly targets require static linking" if="emscripten" unless="static_link" />

	<!--HXCPP Defines-->

	<set name="HXCPP_CPP20" value="1" />

	<!--Project Specific-->

	<set name="PROJECT_NAME" value="rogue" />

	<set name="PROJECT_DIR" value="${this_dir}" />

	<set name="PROJECT_THIRDPARTY_DIR" value="${PROJECT_DIR}/../thirdparty" />

	<set name="PROJECT_LIB_DIR" value="../lib" />

	<!--XML Includes-->

	<section>
		<!--HXCPP Build Tool Common-->
		<include name="${HXCPP}/build-tool/BuildCommon.xml" />

		<!--Libraries Config-->
		<include name="${PROJECT_THIRDPARTY_DIR}/libraries-config.xml" />

		<!--Glad Files-->
		<include name="${PROJECT_THIRDPARTY_DIR}/files/glad-files.xml" />

		<!--SDL Files-->
		<include name="${PROJECT_THIRDPARTY_DIR}/files/sdl-files.xml" />

		<!--SDL_Image Files-->
		<include name="${PROJECT_THIRDPARTY_DIR}/files/sdl_image-files.xml" />

		<!--SDL_TTF Files-->
		<include name="${PROJECT_THIRDPARTY_DIR}/files/sdl_ttf-files.xml" />

		<!--Soft OpenAL Files-->
		<include name="${PROJECT_THIRDPARTY_DIR}/files/soft_oal-files.xml" />
	</section>

	<!--Project Target-->

	<target id="${PROJECT_NAME}" output="${LIBPREFIX}${PROJECT_NAME}${HX_TARGET_SUFFIX}" tool="linker" toolid="${STD_MODULE_LINK}">

		<outdir name="${PROJECT_LIB_DIR}/${BINDIR}" />

		<files id="sdl-files" />

		<files id="sdl_image-files" />

		<section>
			<files id="sdl_ttf-deps-freetype-files" />
			<files id="sdl_ttf-deps-harfbuzz-files" />
			<files id="sdl_ttf-deps-plutovg-files" />
			<files id="sdl_ttf-deps-plutosvg-files" />

			<files id="sdl_ttf-files" />
		</section>

		<files id="glad-files" />

		<section unless="emscripten">
			<files id="soft_oal-deps-fmt-files" />

			<files id="soft_oal-files" />
		</section>

		<section>
			<section if="windows">
				<lib name="advapi32.lib" />
				<lib name="avrt.lib" />
				<lib name="cfgmgr32.lib" />
				<lib name="gdi32.lib" />
				<lib name="imm32.lib" />
				<lib name="ole32.lib" />
				<lib name="oleaut32.lib" />
				<lib name="rpcrt4.lib" />
				<lib name="setupapi.lib" />
				<lib name="shell32.lib" />
				<lib name="usp10.lib" />
				<lib name="version.lib" />
				<lib name="winmm.lib" />
			</section>

			<section if="android">
				<lib name="-lGLESv2" />
				<lib name="-lOpenSLES" />
				<lib name="-landroid" />
			</section>
		</section>
	</target>

	<!--Default Target-->

	<target id="default">

		<target id="${PROJECT_NAME}" />

	</target>

	<!--Tweak Android Linker-->

	<linker id="dll" if="android">
		<flag value="-Wl,-soname,librogue.so" />
	</linker>

	<!--Copy the Windows lib (thanks tobil4sk)-->

	<section if="windows">
		<copyFile toolId="dll" name="${PROJECT_NAME}.lib" from="obj/lib" />
	</section>

</xml>
